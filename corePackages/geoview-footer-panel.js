/*! Package:geoview-footer-panel: 0.1.0 - "24d1fc50878d2c06e98b94f14c90d791976cc084" - 2023-10-11T19:44:54.520Z */
"use strict";(self.webpackChunkgeoview_core=self.webpackChunkgeoview_core||[]).push([[435],{65986:(e,t,n)=>{var a=n(98124),o=n(46623),r=n(78630),i=n(34313),s=n(61987),l=n(18879),u=n(84421),c=n(60558);const f=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"GeoView Footer Config Schema","type":"object","version":1,"comments":"Configuration for GeoView footer package.","additionalProperties":true,"properties":{"tabs":{"type":"object","description":"Available tabs","properties":{"defaultTabs":{"type":"array","items":{"type":"string","enum":["legend","details","data-table"]},"minItems":0,"default":["legend","details","data-table"],"uniqueItems":true,"description":"Defaut tabs of footer panel to use"},"customTabs":{"type":"array","items":{"type":"object","properties":{"defaultTabs":{"type":"string"},"contentHTML":{"type":"string"}}},"minItems":0,"default":[],"uniqueItems":true,"description":"Custom tabs of footer panel to use"}},"additionalProperties":false},"suportedLanguages":{"type":"array","uniqueItems":true,"items":{"type":"string","enum":["en","fr"]},"default":["en","fr"],"description":"ISO 639-1 code indicating the languages supported by the configuration file.","minItems":1},"version":{"type":"string","enum":["1.0"],"description":"The schema version used to validate the configuration file. The schema should enumerate the list of versions accepted by this version of the viewer."},"collapsed":{"type":"boolean","default":true,"description":"State of footer panel when map is loaded"}},"required":["suportedLanguages","tabs"]}'),d=JSON.parse('{"tabs":{"defaultTabs":["legend","details","data-table"],"customTabs":[]},"suportedLanguages":["en","fr"]}');var v=n(38736),p=n(29541),m=window;function E(e){var t=e.mapId,n=m.cgpv,a=n.api,o=n.react,r=o.useState,i=o.useEffect,s=r([]),l=(0,v.Z)(s,2),u=l[0],f=l[1],d=r(),E=(0,v.Z)(d,2),g=E[0],y=E[1],b=r([]),h=(0,v.Z)(b,2),N=h[0],T=h[1],L=r(null),_=(0,v.Z)(L,2),A=_[0],I=_[1],D=function(e){if((0,c.gNW)(e)){var n=e.resultSets,o=[];Object.keys(n).forEach((function(e){var r,i=(0,c.dIw)(a.maps[t].layer.registeredLayers[e].layerName,t),s=null===(r=n[e])||void 0===r?void 0:r.data;null!=s&&s.length&&(null==s?void 0:s.length)>0&&o.push({layerPath:e,layerName:i,features:s})})),console.log("Inside geoview footer panel: ",o),o.length>0?f(o):f([])}else f([])},Z=function(e){if((0,c.gux)(e)){var t=e.coordinates;I(e.handlerName),T(t.lnglat)}else T([])};return i((function(){return a.event.on(a.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,D,"".concat(t,"/FeatureInfoLayerSet")),a.event.on(a.eventNames.MAP.EVENT_MAP_SINGLE_CLICK,Z,t),function(){a.event.off(a.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,t,D),a.event.off(a.eventNames.MAP.EVENT_MAP_SINGLE_CLICK,t,Z)}}),[]),i((function(){y(a.maps[t].detailsFooter.createDetailsFooter(t,u,{mapId:t,location:N,handlerName:A}))}),[u,N]),(0,p.jsx)("div",{children:g})}var g=n(53358),y=window;function b(e){var t=e.mapId,n=y.cgpv,a=n.api,o=n.react,r=o.useState,i=o.useEffect,s=r(),l=(0,v.Z)(s,2),u=l[0],f=l[1],d=r([]),m=(0,v.Z)(d,2),E=m[0],b=m[1],h=function(){var e;void 0!==(null===(e=a.maps[t].layer)||void 0===e?void 0:e.layerOrder)&&b((0,g.Z)(a.maps[t].layer.layerOrder).reverse())},N=function(){return h()},T=function(e){(0,c.UKz)(e)&&b((function(t){return t.filter((function(t){return t!==e.geoviewLayer.geoviewLayerId}))}))},L=function(e){(0,c.riW)(e)&&a.event.on(a.eventNames.LAYER.EVENT_LAYER_ADDED,(function(){h(),a.event.off(a.eventNames.LAYER.EVENT_LAYER_ADDED,"".concat(t,"/").concat(e.layerConfig.geoviewLayerId))}),"".concat(t,"/").concat(e.layerConfig.geoviewLayerId))};return i((function(){return a.event.on(a.eventNames.MAP.EVENT_MAP_LOADED,N,t),a.event.on(a.eventNames.LAYER.EVENT_REMOVE_LAYER,T,t),a.event.on(a.eventNames.LAYER.EVENT_ADD_LAYER,L,t),function(){a.event.off(a.eventNames.MAP.EVENT_MAP_LOADED,t,N),a.event.off(a.eventNames.LAYER.EVENT_REMOVE_LAYER,t,T),a.event.off(a.eventNames.LAYER.EVENT_ADD_LAYER,t,L)}}),[]),i((function(){f(a.maps[t].legend.createLegend({layerIds:E,isRemoveable:!1,canSetOpacity:!0,canZoomTo:!0}))}),[E]),(0,p.jsx)("div",{children:u})}var h=n(11468),N=n(69291),T=n.n(N),L=window;function _(e){var t,n=e.mapId,a=L.cgpv,o=a.api,r=a.react,i=r.useState,s=r.useEffect,l=i(null),u=(0,v.Z)(l,2),c=u[0],f=u[1],d=function(){setTimeout((function(){!function(){(t=t||(0,h.Z)(T().mark((function e(){var t;return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.api.maps[n].dataTable.createDataPanel();case 2:t=e.sent,f(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}()}),1e3)};return s((function(){return o.event.on(o.eventNames.MAP.EVENT_MAP_LOADED,d,n),function(){o.event.off(o.eventNames.MAP.EVENT_MAP_LOADED,n,d)}}),[]),(0,p.jsx)("div",{children:c})}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,l.Z)(e);if(t){var o=(0,l.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,s.Z)(this,n)}}var I=window,D=function(e){(0,i.Z)(n,e);var t=A(n);function n(e,o){var i;return(0,a.Z)(this,n),i=t.call(this,e,o),(0,u.Z)((0,r.Z)(i),"schema",(function(){return f})),(0,u.Z)((0,r.Z)(i),"defaultConfig",(function(){return(0,c.ZQJ)(d)})),(0,u.Z)((0,r.Z)(i),"translations",(0,c.ZQJ)({en:{legend:"Legend",details:"Details",dataTable:"DataTable"},fr:{legend:"Légende",details:"Détails",dataTable:"Données"}})),(0,u.Z)((0,r.Z)(i),"added",(function(){var e=(0,r.Z)(i),t=e.configObj,n=e.pluginProps.mapId,a=I.cgpv;if(a){var o=a.api,s=o.maps[n],l=s.displayLanguage,u=s.footerTabs,f=s.map.getTargetElement().parentElement;f&&(!1===(null==t?void 0:t.collapsed)?f.style.height="calc( 100% - 300px )":f.style.height="calc( 100% - 55px )");var d=null==t?void 0:t.tabs.defaultTabs,v=0;if(d.includes("legend")&&(u.createFooterTab({value:v,label:i.translations[l].legend,content:function(){return(0,p.jsx)(b,{mapId:n})}}),v++),d.includes("details")){var m=v;u.createFooterTab({value:m,label:i.translations[l].details,content:function(){return(0,p.jsx)(E,{mapId:n})}}),v++,o.event.on(o.eventNames.GET_FEATURE_INFO.ALL_QUERIES_DONE,(function(e){if((0,c.gNW)(e)){var t=e.resultSets,n=[];Object.keys(t).forEach((function(e){n=n.concat(t[e])})),n.length>0&&u.selectFooterTab(m)}}),"".concat(n,"/FeatureInfoLayerSet"))}d.includes("data-table")&&(u.createFooterTab({value:v,label:i.translations[l].dataTable,content:function(){return(0,p.jsx)(_,{mapId:n})}}),v++);for(var g=null==t?void 0:t.tabs.customTabs,y=0;y<g.length;y++){var h=g[y];u.createFooterTab({value:v,label:h.title,content:h.contentHTML}),v++}}})),i.buttonPanel=null,i}return(0,o.Z)(n,[{key:"removed",value:function(){I.cgpv}}]),n}(c.Vw$);I.plugins=I.plugins||{},I.plugins["footer-panel"]=(0,c.RFZ)(D)}},e=>{var t;t=65986,e(e.s=t)}]);
//# sourceMappingURL=geoview-footer-panel.js.map